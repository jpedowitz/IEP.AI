<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IEP v14 (Master)</title>
  <style>
    :root {
      --bg: #0b1220;
      --panel: #121a2b;
      --text: #e8eef8;
      --muted: #9fb3c8;
      --accent: #6ee7ff;
      --border: #22304a;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .app { display: grid; grid-template-columns: 240px 1fr; height: 100%; }
    .sidebar { background: #0a1020; border-right: 1px solid var(--border); padding: 14px; display: flex; flex-direction: column; gap: 12px; }
    .logo { display: flex; align-items: center; gap: 8px; font-weight: 800; color: var(--text); }
    .nav-menu { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 6px; }
    .nav-item { display: flex; gap: 8px; align-items: center; padding: 10px 12px; border: 1px solid var(--border); border-radius: 10px; cursor: pointer; background: #0a1020; color: var(--text); }
    .nav-item:hover { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(110,231,255,.12); }
    .main { display: flex; flex-direction: column; }
    .topbar { padding: 12px 16px; border-bottom: 1px solid var(--border); background: #0a1020; display: flex; align-items: center; justify-content: space-between; }
    .content { padding: 16px; overflow: auto; }
    .card { background: var(--panel); border: 1px solid var(--border); border-radius: 14px; padding: 16px; }
    .form-tabs { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
    .form-tab { background: #0a1020; color: var(--text); border: 1px solid var(--border); border-radius: 10px; padding: 8px 12px; cursor: pointer; }
    .form-tab.active { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(110,231,255,.18); }
    .form-page { display: none; }
    .form-page.active { display: block; }
    .section-title { margin: 0 0 10px; font-size: 16px; color: var(--muted); }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="logo"><span>üéì</span><span>IEP.AI</span></div>
      <ul class="nav-menu">
        <li class="nav-item" onclick="showView('dashboard')"><span>üìä</span><span>Dashboard</span></li>
        <li class="nav-item" onclick="showView('iep')"><span>‚ûï</span><span>IEP Report</span></li>
        <li class="nav-item" onclick="window.open('files.html','_blank')"><span>üìÅ</span><span>Files</span></li>
        <li class="nav-item" onclick="window.open('timeline.html','_blank')"><span>üìÖ</span><span>Timeline Tracker</span></li>
      </ul>
    </aside>
    <main class="main">
      <div class="topbar"><div>IEP v14 Master</div><div style="opacity:.7">No timeline inside report</div></div>
      <div class="content">
        <div id="dashboard" class="card" style="display:none">
          <h2 class="section-title">Welcome</h2>
          <div>This is a simplified dashboard. Use the left navigation to open the IEP report, Files, or the standalone Timeline.</div>
        </div>

        <div id="iep" class="card" style="display:block">
          <div class="form-tabs" id="tabs"></div>
          <div id="pages"></div>
        </div>
      </div>
    </main>
  </div>

  <script>
    function showView(which){
      document.getElementById('dashboard').style.display = (which==='dashboard') ? 'block' : 'none';
      document.getElementById('iep').style.display       = (which==='iep') ? 'block' : 'none';
    }

    // Build 34 IEP pages without any Timeline tab
    (function buildIep(){
      const tabs  = document.getElementById('tabs');
      const pages = document.getElementById('pages');

      function makeTab(pageIdx){
        const btn = document.createElement('button');
        btn.className = 'form-tab';
        btn.textContent = `Page ${pageIdx}: Section`;
        btn.setAttribute('data-page', `page${pageIdx}`);
        btn.addEventListener('click', () => activate(`page${pageIdx}`));
        return btn;
      }

      function makePage(pageIdx){
        const div = document.createElement('div');
        div.className = 'form-page';
        div.id = `page${pageIdx}`;
        div.innerHTML = `<h3 class="section-title">Page ${pageIdx}</h3><div>Placeholder content for Page ${pageIdx}. Timeline is not part of this report.</div>`;
        return div;
      }

      for (let i=1; i<=34; i++) {
        tabs.appendChild(makeTab(i));
        pages.appendChild(makePage(i));
      }

      function activate(id){
        // pages
        pages.querySelectorAll('.form-page').forEach(p => p.classList.toggle('active', p.id===id));
        // tabs
        tabs.querySelectorAll('.form-tab').forEach(t => t.classList.toggle('active', t.getAttribute('data-page')===id));
      }
      window.activate = activate;

      // default to page 1
      activate('page1');
      tabs.querySelector('.form-tab')?.classList.add('active');
    })();
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IEP v14 (Master)</title>
  <style>
    html, body { height: 100%; margin: 0; background: #0b1220; }
    .frame-wrap { position: fixed; inset: 0; }
    iframe { width: 100%; height: 100%; border: 0; background: #0b1220; }
  </style>
</head>
<body>
  <div class="frame-wrap">
    <!-- Load the latest IEP file here -->
    <iframe id="iep" src="IEP_v11_fixed_patched.html" title="IEP"></iframe>
  </div>

  <script>
    (function(){
      const iep = document.getElementById('iep');

      function injectCss(doc, css) {
        const style = doc.createElement('style');
        style.type = 'text/css';
        style.appendChild(doc.createTextNode(css));
        doc.head.appendChild(style);
      }

      function hideTimeline(doc) {
        // Hard CSS hide as a first guarantee
        injectCss(doc, `
          .form-tabs .form-tab[data-page="pageTL"]{ display:none !important; }
          .form-tabs a.form-tab[data-page="pageTL"]{ display:none !important; }
          #pageTL{ display:none !important; }
          #timelineApp{ display:none !important; }
        `);

        // Try DOM removals as well for cleanliness
        try {
          doc.querySelectorAll('.form-tabs .form-tab').forEach(tab => {
            const page = tab.getAttribute('data-page');
            const label = (tab.textContent || '').toLowerCase();
            if (page === 'pageTL' || label.includes('timeline')) tab.remove();
          });
        } catch(e) {}
        try { const page = doc.getElementById('pageTL'); page && page.remove(); } catch(e) {}
        try { const app  = doc.getElementById('timelineApp'); app && app.remove(); } catch(e) {}
      }

      function fixLeftNav(doc) {
        const navMenu = doc.querySelector('.sidebar .nav-menu');
        if (!navMenu) return;

        const items = Array.from(navMenu.children || []);
        // Ensure a single Files item exists (after Create New IEP if present)
        if (!items.some(li => (/\bfiles\b/i).test(li.textContent || ''))) {
          const filesLi = doc.createElement('li');
          filesLi.className = 'nav-item';
          filesLi.innerHTML = '<span>üìÅ</span><span>Files</span>';
          filesLi.addEventListener('click', () => window.open('files.html','_blank'));
          if (items[1] && items[1].parentNode === navMenu) {
            items[1].after(filesLi);
          } else {
            navMenu.appendChild(filesLi);
          }
        }

        // Make any existing Timeline nav open in a new window
        const timelineLi = (Array.from(navMenu.querySelectorAll('.nav-item')))
          .find(li => (/timeline\s*tracker/i).test(li.textContent || ''));
        if (timelineLi) {
          timelineLi.onclick = null;
          timelineLi.addEventListener('click', (e) => {
            e.preventDefault();
            window.open('timeline.html', '_blank');
          });
        }
      }

      function afterLoad() {
        const doc = iep.contentDocument || iep.contentWindow?.document;
        if (!doc) return;

        // Run immediately
        hideTimeline(doc);
        fixLeftNav(doc);

        // Also retry a few times in case the app hydrates late
        let tries = 0;
        const timer = setInterval(() => {
          tries++;
          hideTimeline(doc);
          fixLeftNav(doc);
          if (tries >= 30) clearInterval(timer);
        }, 200);
      }

      iep.addEventListener('load', afterLoad);
    })();
  </script>
</body>
</html>


<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>IEP.AI - Maryland IEP Management Platform</title>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: #F7F8FA;
            min-height: 100vh;
        }

        .dashboard-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #000000;
            box-shadow: 2px 0 20px rgba(0,0,0,0.1);
            padding: 2rem 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0 1.5rem;
            margin-bottom: 2rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #00D563;
        }

        .nav-menu { list-style: none; }

        .nav-item {
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        .nav-item:hover { background: rgba(0, 213, 99, 0.1); color: #00D563; }
        .nav-item.active { background: rgba(0, 213, 99, 0.2); color: #00D563; border-left: 4px solid #00D563; font-weight: 600; }

        /* Right Sidebar */
        .right-sidebar {
            width: 380px;
            background: #FFFFFF;
            box-shadow: -2px 0 10px rgba(0,0,0,0.05);
            padding: 2rem 1.5rem;
            display: block;
        }
        .right-sidebar.hidden { display: none; }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #F7F8FA;
            max-width: calc(100vw - 630px);
        }
        .main-content.full-width { max-width: calc(100vw - 250px); }

        .top-bar {
            background: #FFFFFF;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background: #F7F8FA;
            border-radius: 25px;
            padding: 0.5rem 1rem;
            width: 400px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .search-bar:focus-within { border-color: #00D563; background: white; box-shadow: 0 0 0 3px rgba(0, 213, 99, 0.1); }
        .search-bar input { border: none; background: none; outline: none; width: 100%; margin-left: 0.5rem; }

        .user-info { display: flex; align-items: center; gap: 1rem; }
        .notification-bell { position: relative; cursor: pointer; }
        .notification-badge { position: absolute; top: -5px; right: -5px; background: #FFD700; color: #000000; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: 600; }

        .content-area { flex: 1; padding: 2rem; overflow-y: auto; width: 100%; }

        /* Views */
        .dashboard-view { display: none; }
        .dashboard-view.active { display: block; }
        .iep-creator-view { display: none; }
        .iep-creator-view.active { display: block; }
        .timeline-view { display: none; }
        .timeline-view.active { display: block; }

        .dashboard-header { margin-bottom: 2rem; }
        .dashboard-header h1 { color: #000000; margin-bottom: 0.5rem; font-weight: 700; }
        .dashboard-header p { color: #6B7280; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: #FFFFFF; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); transition: all 0.3s; border: 2px solid transparent; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0, 213, 99, 0.15); border-color: #00D563; }
        .stat-number { font-size: 2rem; font-weight: bold; color: #00D563; }
        .stat-label { color: #6B7280; margin-top: 0.5rem; }

        /* IEP Form */
        .iep-form-container { display: none; background: #FFFFFF; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; width: 100%; max-width: 1400px; margin: 0 auto; }
        .form-header { background: #000000; color: white; padding: 2rem; position: relative; overflow: hidden; }
        .form-header::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #00D563 0%, #FFD700 100%); }
        .form-tabs { display: flex; background: #F7F8FA; border-bottom: 2px solid #E5E7EB; overflow-x: auto; }
        .form-tab { padding: 1rem 1.5rem; background: none; border: none; cursor: pointer; font-size: 0.9rem; color: #6B7280; white-space: nowrap; transition: all 0.3s; border-bottom: 3px solid transparent; font-weight: 500; }
        .form-tab:hover { background: rgba(0, 213, 99, 0.05); color: #00D563; }
        .form-tab.active { color: #00D563; background: white; border-bottom-color: #00D563; font-weight: 600; }
        .form-content { padding: 2rem; height: calc(100vh - 250px); overflow-y: auto; overflow-x: hidden; background: #F7F8FA; position: relative; }
        .form-page { display: none; width: 100%; min-height: 100%; position: relative; visibility: visible; opacity: 1; }
        .form-section { margin-bottom: 2rem; padding: 1.5rem; background: #FFFFFF; border-radius: 8px; border-left: 4px solid #00D563; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .section-title { font-size: 1.2rem; font-weight: 600; color: #000000; margin-bottom: 1rem; }
        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; font-weight: 500; color: #4B5563; margin-bottom: 0.25rem; font-size: 0.9rem; }
        .form-input { width: 100%; padding: 0.75rem; border: 2px solid #E5E7EB; border-radius: 6px; font-size: 0.95rem; background: white; transition: all 0.3s; }
        .form-textarea { width: 100%; padding: 0.75rem; border: 2px solid #E5E7EB; border-radius: 6px; font-size: 0.95rem; background: white; min-height: 100px; resize: vertical; font-family: inherit; }
        .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; }

        /* Timeline app styles (reused) */
        #timelineApp{--bg:#0b1220;--card:#121a2b;--text:#e8eef8;--muted:#9fb3c8;--accent:#6ee7ff;--warn:#fb923c;--danger:#f87171;--shadow:0 10px 25px rgba(0,0,0,.25)}
        #timelineApp .card{background:var(--card);box-shadow:var(--shadow);border-radius:16px;padding:16px;border:1px solid #22304a}
        #timelineApp .row{display:flex;gap:12px;flex-wrap:wrap}
        #timelineApp .field{flex:1 1 220px;display:flex;flex-direction:column;gap:6px}
        #timelineApp label{font-weight:600;color:var(--muted);font-size:13px}
        #timelineApp input[type="date"], #timelineApp input[type="text"], #timelineApp select{background:#0a1020;border:1px solid #22304a;color:var(--text);padding:10px;border-radius:10px;outline:none}
        #timelineApp .persona{display:flex;gap:8px;margin-top:6px}
        #timelineApp .persona button{background:#0a1020;color:var(--text);border:1px solid #22304a;border-radius:999px;padding:8px 14px;cursor:pointer}
        #timelineApp .persona button.active{border-color:var(--accent);box-shadow:0 0 0 3px rgba(110,231,255,.15)}
        #timelineApp .timeline{position:relative;background:#0a1020;border:1px solid #22304a;border-radius:14px;margin-top:16px;overflow:auto;padding:22px}
        #timelineApp .track{position:relative;height:6px;background:linear-gradient(90deg,#1d2a44,#20375d);border-radius:10px;margin:30px 6px;min-width:900px}
        #timelineApp .tick{position:absolute;top:-12px;width:2px;height:30px;background:#33456e}
        #timelineApp .marker{position:absolute;top:calc(50% - 10px);transform:translateX(-50%);background:transparent;border:none;padding:0}
        #timelineApp .dot{width:12px;height:12px;border-radius:50%;background:var(--accent);border:2px solid #0a1020;box-shadow:0 0 0 3px rgba(110,231,255,.18)}
        #timelineApp .dot.warn{background:var(--warn)}
        #timelineApp .dot.danger{background:var(--danger)}
        #timelineApp .label{white-space:nowrap;transform:translate(-50%,8px);font-size:12px;color:var(--text);text-align:center}
        #timelineApp .callout{position:absolute;transform:translate(-50%,-110%);background:#0a1020;border:1px solid #28406b;border-radius:12px;min-width:240px;max-width:340px;padding:10px;box-shadow:var(--shadow);display:none;z-index:10}
        #timelineApp .marker:hover .callout, #timelineApp .marker:focus-within .callout{display:block}
        #timelineApp .callout h4{margin:0 0 6px;font-size:14px}
        #timelineApp .pill{display:inline-block;border:1px solid #28406b;border-radius:999px;padding:2px 8px;font-size:11px;color:var(--muted);margin-right:6px}
        #timelineApp .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
        #timelineApp .leg{display:flex;align-items:center;gap:6px;color:var(--muted);font-size:12px}
        #timelineApp .key{width:10px;height:10px;border-radius:50%}
        #timelineApp .grid{display:grid;grid-template-columns: 1fr 1fr; gap:12px;margin-top:10px}
        #timelineApp .btn{background:var(--accent);color:#001018;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
        @media (max-width:800px){ #timelineApp .grid{grid-template-columns:1fr} }
</style>
</head>
<body>
<div class="dashboard-container">
<!-- Sidebar -->
<div class="sidebar">
<div class="logo"><span>üéì</span><span>IEP.AI</span></div>
<ul class="nav-menu">
<li class="nav-item active" onclick="showView('dashboard')"><span>üìä</span><span>Dashboard</span></li>
<li class="nav-item" onclick="showView('iep-creator')"><span>‚ûï</span><span>Create New IEP</span></li>
<li class="nav-item" onclick="showView('timeline')"><span>üìÖ</span><span>Timeline Tracker</span></li>
<li class="nav-item"><span>üí¨</span><span>Q&amp;A Assistant</span></li>
<li class="nav-item"><span>üìö</span><span>Resources</span></li>
<li class="nav-item"><span>üë•</span><span>Meeting Coordination</span></li>
<li class="nav-item"><span>üìà</span><span>Reports</span></li>
<li class="nav-item"><span>‚öôÔ∏è</span><span>Settings</span></li>
</ul>
</div>
<!-- Main Content -->
<div class="main-content">
<div class="top-bar">
  <div class="search-bar"><span>üîç</span><input type="text" placeholder="Search students, IEPs, or documents..."/></div>
  <div class="user-info"><div class="notification-bell"><span style="font-size: 1.5rem;">üîî</span><div class="notification-badge">3</div></div><span>üë§ Sarah Johnson</span></div>
</div>
<div class="content-area">
  <!-- Dashboard View -->
  <div id="dashboard-view" class="dashboard-view active">
    <div class="dashboard-header"><h1>Welcome back, Sarah!</h1><p>Here's your IEP management overview for Montgomery County</p></div>
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-number">47</div><div class="stat-label">Active IEPs</div></div>
      <div class="stat-card"><div class="stat-number">12</div><div class="stat-label">Due This Month</div></div>
      <div class="stat-card"><div class="stat-number">8</div><div class="stat-label">Meetings Scheduled</div></div>
      <div class="stat-card"><div class="stat-number">3</div><div class="stat-label">Pending Reviews</div></div>
    </div>
    <div style="background: #FFFFFF; padding: 2rem; border-radius: 12px; margin-top: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
      <h2 style="margin-bottom: 1rem; color: #000000;">Recent Activity</h2>
      <div style="padding: 1rem; background: rgba(0, 213, 99, 0.1); border-radius: 8px; margin-bottom: 0.5rem; border-left: 3px solid #00D563;">‚úÖ IEP completed for Michael Thompson - Nov 15, 2024</div>
      <div style="padding: 1rem; background: rgba(0, 213, 99, 0.1); border-radius: 8px; margin-bottom: 0.5rem; border-left: 3px solid #00D563;">üìÖ Meeting scheduled with Jennifer Martinez - Nov 20, 2024</div>
      <div style="padding: 1rem; background: rgba(0, 213, 99, 0.1); border-radius: 8px; border-left: 3px solid #00D563;">üìù Draft IEP pending review - Sarah Williams</div>
    </div>
  </div>

  <!-- IEP Creator View -->
  <div id="iep-creator-view" class="iep-creator-view">
    <div class="upload-section" id="uploadSection">
      <h2 style="margin-bottom: 1rem; color: #000000;">üéôÔ∏è Audio to IEP Converter</h2>
      <div class="upload-area"><div style="font-size: 3rem;">üìÅ</div><h3 style="color: #000000;">Drop your IEP meeting recording here</h3><p style="color: #6B7280; margin: 1rem 0;">or click to browse</p><button class="demo-btn" onclick="startDemo()">‚ú® Run Demo with Sample Audio</button></div>
    </div>
    <div class="processing-animation" id="processingSection">
      <h3 style="margin-bottom: 1rem; color: #000000;">ü§ñ AI Processing Your Recording...</h3>
      <div class="processing-step" id="step1"><div class="spinner"></div><span>Transcribing audio...</span></div>
      <div class="processing-step" id="step2"><div class="spinner"></div><span>Analyzing student needs...</span></div>
      <div class="processing-step" id="step3"><div class="spinner"></div><span>Extracting goals...</span></div>
      <div class="processing-step" id="step4"><div class="spinner"></div><span>Generating IEP sections...</span></div>
      <div class="processing-step" id="step5"><div class="spinner"></div><span>Finalizing document...</span></div>
    </div>
    <div class="iep-form-container" id="iepForm">
      <div class="form-header"><h2>Maryland IEP - Individualized Education Program</h2><p>Generated from IEP Team Meeting - November 15, 2024</p></div>
      <div class="form-tabs">
        <button class="form-tab active" data-page="page1">Page 1: Student Information</button>
        <button class="form-tab" data-page="page2">Page 2: Meeting &amp; Identifying Info</button>
        <button class="form-tab" data-page="page3">Page 3: Meeting &amp; Identifying Info </button>
        <button class="form-tab" data-page="page4">Page 4: Meeting &amp; Identifying Info</button>
        <button class="form-tab" data-page="page5">Page 5: Meeting &amp; Identifying Info</button>
        <button class="form-tab" data-page="page6">Page 6: Present Levels</button>
        <button class="form-tab" data-page="page7">Page 7: Present Levels</button>
        <button class="form-tab" data-page="page8">Page 8: Present Levels</button>
        <button class="form-tab" data-page="page9">Page 9: Present Levels</button>
        <button class="form-tab" data-page="page10">Page 10: Services</button>
        <a class="form-tab" data-page="page11" href="#">Page 11: Special Considerations II</a>
        <a class="form-tab" data-page="page12" href="#">Page 12: Accessibility Features I</a>
        <a class="form-tab" data-page="page13" href="#">Page 13: Accessibility Features II</a>
        <a class="form-tab" data-page="page14" href="#">Page 14: Accommodations: Presentation</a>
        <a class="form-tab" data-page="page15" href="#">Page 15: Accommodations: Response</a>
        <a class="form-tab" data-page="page16" href="#">Page 16: Timing Accommodations</a>
        <a class="form-tab" data-page="page17" href="#">Page 17: Instructional Supports</a>
        <a class="form-tab" data-page="page18" href="#">Page 18: Program Modifications</a>
        <a class="form-tab" data-page="page19" href="#">Page 19: Social/Behavior Supports</a>
        <a class="form-tab" data-page="page20" href="#">Page 20: Physical/Environmental Supports</a>
        <a class="form-tab" data-page="page21" href="#">Page 21: School Personnel/Parental Supports</a>
        <a class="form-tab" data-page="page22" href="#">Page 22: Extended School Year (ESY)</a>
        <a class="form-tab" data-page="page23" href="#">Page 23: Transition ‚Äì Preferences &amp; Goals</a>
        <a class="form-tab" data-page="page24" href="#">Page 24: Transition Activities I</a>
        <a class="form-tab" data-page="page25" href="#">Page 25: Transition Activities II</a>
        <a class="form-tab" data-page="page26" href="#">Page 26: Transition Activities III</a>
        <a class="form-tab" data-page="page27" href="#">Page 27: Transition Agency Linkage</a>
        <a class="form-tab" data-page="page28" href="#">Page 28: Goals ‚Äì Goal Sheet</a>
        <a class="form-tab" data-page="page29" href="#">Page 29: Services ‚Äì Special Education</a>
        <a class="form-tab" data-page="page30" href="#">Page 30: Services ‚Äì Related Services</a>
        <a class="form-tab" data-page="page31" href="#">Page 31: Services ‚Äì CTE</a>
        <a class="form-tab" data-page="page32" href="#">Page 32: Placement Data (LRE)</a>
        <a class="form-tab" data-page="page33" href="#">Page 33: Authorization ‚Äì Consent</a>
        <a class="form-tab" data-page="page34" href="#">Page 34: Authorization ‚Äì Medical Assistance</a>
      </div>
      <div class="form-content">
        <div id="pageTL" class="form-page" style="display:none;">
          <div class="form-section"><h3 class="section-title">Interactive IEP Timeline</h3>
            <div id="timelineApp">
              <div class="card">
                <div class="row">
                  <div class="field"><label>IEP Meeting Date</label><input id="tl_meetingDate" type="date"/></div>
                  <div class="field"><label>Eligibility Decision Date</label><input id="tl_eligDate" type="date"/></div>
                  <div class="field"><label>Signed Consent (Initial Evaluation)</label><input id="tl_consentDate" type="date"/></div>
                  <div class="field"><label>Team Decision for Updated Evaluations</label><input id="tl_revalDecisionDate" type="date"/></div>
                </div>
                <div class="row">
                  <div class="field"><label>Persona</label><div class="persona"><button class="active" data-persona="parent">Parent</button><button data-persona="educator">Educator</button></div></div>
                  <div class="field"><label>Business-Day Calendar</label><select id="tl_businessRegion"><option value="US">US (weekends excluded)</option></select></div>
                  <div class="field"><label> </label><button class="btn" id="tl_recalc">Recalculate</button></div>
                </div>
              </div>
              <div class="timeline card" id="tl_timelineCard"><div class="legend"><span class="leg"><span class="key" style="background:var(--accent)"></span>Due date</span><span class="leg"><span class="key" style="background:var(--warn)"></span>Approaching (‚â§ 3 days)</span><span class="leg"><span class="key" style="background:var(--danger)"></span>Past due</span></div><div class="track" id="tl_track"></div></div>
            </div>
          </div>
        </div>
        <div id="page1" class="form-page" style="display:block;">
          <div class="form-section"><h3 class="section-title">I. MEETING AND IDENTIFYING INFORMATION</h3></div>
        </div>
        <!-- Other pages unchanged -->
      </div>
    </div>
  </div>

  <!-- Standalone Timeline View -->
  <div id="timeline-view" class="timeline-view">
    <div class="form-header"><h2>Timeline Tracker</h2><p>Key dates and deadlines</p></div>
    <div class="form-content">
      <div class="form-section">
        <div id="timelineAppStandalone"></div>
      </div>
    </div>
  </div>
</div>
</div>
<!-- Right Sidebar removed for single-left-nav layout -->

<script>
  function showView(viewName) {
    const mainContent = document.querySelector('.main-content');
    const dash = document.getElementById('dashboard-view');
    const creator = document.getElementById('iep-creator-view');
    const timeline = document.getElementById('timeline-view');

    dash.classList.remove('active');
    creator.classList.remove('active');
    timeline.classList.remove('active');

    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));

    if (viewName === 'dashboard') {
      dash.classList.add('active');
      mainContent.classList.remove('full-width');
    } else if (viewName === 'iep-creator') {
      creator.classList.add('active');
      mainContent.classList.add('full-width');
    } else if (viewName === 'timeline') {
      timeline.classList.add('active');
      mainContent.classList.add('full-width');
      ensureStandaloneTimeline();
    }

    try { event?.currentTarget?.classList.add('active'); } catch(e) {}
  }

  function ensureStandaloneTimeline(){
    const src = document.getElementById('timelineApp');
    const dest = document.getElementById('timelineAppStandalone');
    if (src && dest && dest.childElementCount === 0) {
      dest.appendChild(src.cloneNode(true));
      wireTimeline(dest);
    }
  }

  function startDemo() {
    document.getElementById('uploadSection').style.display = 'none';
    document.getElementById('processingSection').style.display = 'block';
    const steps = ['step1','step2','step3','step4','step5'];
    steps.forEach((id,i)=>setTimeout(()=>document.getElementById(id).classList.add('active'), i*1000));
    setTimeout(()=>{
      document.getElementById('processingSection').style.display='none';
      document.getElementById('iepForm').style.display='block';
      document.getElementById('page1').style.display='block';
    }, 6000);
  }

  function initializeTabs() {
    const tabs = document.querySelectorAll('.form-tab');
    const pages = document.querySelectorAll('.form-page');
    tabs.forEach(tab=>{
      tab.addEventListener('click', function(e){
        e.preventDefault();
        const id = this.getAttribute('data-page');
        tabs.forEach(t=>t.classList.remove('active'));
        this.classList.add('active');
        pages.forEach(p=>p.style.display='none');
        const page = document.getElementById(id);
        if (page) page.style.display='block';
        window.scrollTo(0,0);
      });
    });
  }
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initializeTabs); else initializeTabs();

  function wireTimeline(root){
    const $ = (sel,ctx=root)=> (ctx||root).querySelector(sel);
    const $$ = (sel,ctx=root)=> Array.from((ctx||root).querySelectorAll(sel));
    const parse = s => s ? new Date(s + 'T00:00:00') : null;
    const fmt = d => d ? d.toLocaleDateString() : '‚Äî';
    function addCal(d,n){ let x=new Date(d); x.setDate(x.getDate()+n); return x; }
    function addBus(d,n){ let days=0,x=new Date(d),step=n>=0?1:-1; while(days!==n){ x.setDate(x.getDate()+step); const dow=x.getDay(); if(dow!==0&&dow!==6){ days+=step; } } return x; }
    function dd(a,b){ const ms=86400000; return Math.round((a-b)/ms); }

    const COPY = {
      parent: { meetingNotice:"School sends IEP meeting notice (10 calendar days before).", draftIEP:"Receive draft IEP & documents (5 business days before meeting).", finalIEP:"Receive finalized IEP and PWNs (within 5 business days after meeting).", consent:"You may consent or refuse proposed items (within 15 business days after meeting).", developed:"IEP must be developed within 30 calendar days after eligibility determination.", initialEval:"Initial evaluation completed within 60 calendar days of signed consent.", reevaluation:"Reevaluation (if required) completed within 90 calendar days of Team decision.", annual:"IEP is reviewed and updated at least annually.", triennial:"Eligibility & educational needs reviewed at least every 3 years." },
      educator: { meetingNotice:"Send IEP meeting notice (10 calendar days before).", draftIEP:"Provide draft IEP & relevant documents (5 business days before).", finalIEP:"Send finalized IEP and PWNs (within 5 business days after).", consent:"Collect parent consent/refusal (within 15 business days after meeting).", developed:"Develop the IEP within 30 calendar days after eligibility determination.", initialEval:"Complete initial evaluation within 60 calendar days of signed consent.", reevaluation:"Complete reevaluation within 90 calendar days of Team decision (if needed).", annual:"Schedule & complete annual IEP review.", triennial:"Ensure reevaluation at least every 3 years." }
    };

    let persona="parent";
    const personaBtns = $$('.persona button');
    personaBtns.forEach(b=>b.addEventListener('click',()=>{
      personaBtns.forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      persona = b.dataset.persona;
      render();
    }));
    $('#tl_recalc').addEventListener('click', render);

    function itemsFromInputs(){
      const m = parse($('#tl_meetingDate').value);
      const elig = parse($('#tl_eligDate').value);
      const consent = parse($('#tl_consentDate').value);
      const reval = parse($('#tl_revalDecisionDate').value);
      const now = new Date();
      const items=[];
      if(m){
        items.push({id:'notice',date:addCal(m,-10),title:'Meeting Notice (10 calendar days before)',copy:COPY[persona].meetingNotice});
        items.push({id:'draft',date:addBus(m,-5),title:'Draft IEP/Docs (5 business days before)',copy:COPY[persona].draftIEP});
        items.push({id:'final',date:addBus(m,5),title:'Final IEP & PWN (‚â§ 5 business days after)',copy:COPY[persona].finalIEP});
        items.push({id:'consent',date:addBus(m,15),title:'Consent Window (‚â§ 15 business days after)',copy:COPY[persona].consent});
      }
      if(elig){
        items.push({id:'develop',date:addCal(elig,30),title:'IEP Developed (‚â§ 30 calendar days)',copy:COPY[persona].developed});
        items.push({id:'annual',date:addCal(elig,365),title:'Annual Review (approx.)',copy:COPY[persona].annual});
      }
      if(consent){ items.push({id:'initial',date:addCal(consent,60),title:'Initial Evaluation Complete (‚â§ 60 calendar days)',copy:COPY[persona].initialEval}); }
      if(reval){
        items.push({id:'reeval',date:addCal(reval,90),title:'Reevaluation Complete (‚â§ 90 calendar days)',copy:COPY[persona].reevaluation});
        items.push({id:'triennial',date:addCal(reval,365*3),title:'Triennial Reevaluation (approx.)',copy:COPY[persona].triennial});
      }
      items.forEach(it=>{ const delta = dd(it.date, now); if(delta<0) it.sev='danger'; else if(delta<=3) it.sev='warn'; });
      return items.sort((a,b)=>a.date-b.date);
    }

    function render(){
      const track = $('#tl_track');
      const items = itemsFromInputs();
      const now = new Date();
      const min = items.length ? items[0].date : new Date(now.getFullYear(), now.getMonth(), now.getDate()-30);
      const max = items.length ? items[items.length-1].date : new Date(now.getFullYear(), now.getMonth(), now.getDate()+90);
      const start = new Date(min); start.setDate(start.getDate()-20);
      const end = new Date(max); end.setDate(end.getDate()+20);
      const span = (end - start) || 1;
      track.innerHTML = '';
      for(let i=0;i<6;i++){
        const x = i/5; const left = (x*100).toFixed(2)+'%';
        const tick = document.createElement('div'); tick.className='tick'; tick.style.left=left; track.appendChild(tick);
      }
      items.forEach(it=>{
        const x = ((it.date - start)/span); const left = (x*100).toFixed(2)+'%';
        const marker = document.createElement('button'); marker.className='marker'; marker.style.left = left;
        marker.innerHTML = `<div class="dot ${it.sev||''}"></div><div class="label">${it.title}<br/>${it.date.toLocaleDateString()}</div><div class="callout"><h4>${it.title}</h4><span class="pill">${(it.date||new Date()).toLocaleDateString()}</span><div>${it.copy}</div></div>`;
        track.appendChild(marker);
      });
    }
    render();
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    showView('dashboard');
  });
</script>
</body>
</html>